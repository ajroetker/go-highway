// Code generated by github.com/ajroetker/go-highway/cmd/hwygen. DO NOT EDIT.

package quantize

import (
	"github.com/ajroetker/go-highway/hwy"
)

func BaseDequantizeUint8_fallback(input []uint8, output []float32, min float32, scale float32) {
	if len(input) == 0 {
		return
	}
	n := len(input)
	if len(output) < n {
		n = len(output)
	}
	minVec := float32(min)
	scaleVec := float32(scale)
	buf := make([]float32, 1)
	i := 0
	for ; i < n; i++ {
		for j := range 1 {
			buf[j] = float32(input[i+j])
		}
		v := buf[0]
		result := v*scaleVec + minVec
		output[i] = result
	}
	for ; i < n; i++ {
		output[i] = min + float32(input[i])*scale
	}
}

func BaseQuantizeFloat32_fallback(input []float32, output []uint8, min float32, scale float32) {
	if len(input) == 0 {
		return
	}
	n := len(input)
	if len(output) < n {
		n = len(output)
	}
	lanes := hwy.NumLanes[float32]()
	minVec := hwy.Set[float32](min)
	invScaleVec := hwy.Set[float32](1.0 / scale)
	zeroVec := hwy.Zero[float32]()
	max255Vec := hwy.Set[float32](255.0)
	buf := make([]float32, lanes)
	i := 0
	for ; i+lanes <= n; i += lanes {
		v := hwy.Load(input[i:])
		diff := hwy.Mul(hwy.Sub(v, minVec), invScaleVec)
		rounded := hwy.Clamp(hwy.Round(diff), zeroVec, max255Vec)
		hwy.Store(rounded, buf)
		for j := range lanes {
			output[i+j] = uint8(buf[j])
		}
	}
	for ; i < n; i++ {
		val := (input[i] - min) / scale
		rounded := float32(int32(val + 0.5))
		if rounded < 0 {
			rounded = 0
		}
		if rounded > 255 {
			rounded = 255
		}
		output[i] = uint8(rounded)
	}
}
