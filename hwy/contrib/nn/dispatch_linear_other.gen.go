// Code generated by github.com/ajroetker/go-highway/cmd/hwygen. DO NOT EDIT.

//go:build !arm64 && !(amd64 && goexperiment.simd)

package nn

import (
	"github.com/ajroetker/go-highway/hwy"
)

var LinearFloat16 func(x []hwy.Float16, weight []hwy.Float16, bias []hwy.Float16, output []hwy.Float16, batchSize int, inFeatures int, outFeatures int)
var LinearBFloat16 func(x []hwy.BFloat16, weight []hwy.BFloat16, bias []hwy.BFloat16, output []hwy.BFloat16, batchSize int, inFeatures int, outFeatures int)
var LinearFloat32 func(x []float32, weight []float32, bias []float32, output []float32, batchSize int, inFeatures int, outFeatures int)
var LinearFloat64 func(x []float64, weight []float64, bias []float64, output []float64, batchSize int, inFeatures int, outFeatures int)

// Linear computes a linear (fully-connected) layer: output = x @ weight^T + bias.
//
//   - x is [batchSize, inFeatures] (row-major)
//   - weight is [outFeatures, inFeatures] (row-major, PyTorch format)
//   - bias is [outFeatures] (optional, pass nil to skip)
//   - output is [batchSize, outFeatures] (row-major)
//
// This uses SIMD dot-product accumulation along inFeatures with 4-row unrolling,
// matching the BaseMatMulKLast pattern, plus an optional SIMD bias add.
//
// This function dispatches to the appropriate SIMD implementation at runtime.
func Linear[T hwy.Floats](x []T, weight []T, bias []T, output []T, batchSize int, inFeatures int, outFeatures int) {
	switch any(x).(type) {
	case []hwy.Float16:
		LinearFloat16(any(x).([]hwy.Float16), any(weight).([]hwy.Float16), any(bias).([]hwy.Float16), any(output).([]hwy.Float16), batchSize, inFeatures, outFeatures)
	case []hwy.BFloat16:
		LinearBFloat16(any(x).([]hwy.BFloat16), any(weight).([]hwy.BFloat16), any(bias).([]hwy.BFloat16), any(output).([]hwy.BFloat16), batchSize, inFeatures, outFeatures)
	case []float32:
		LinearFloat32(any(x).([]float32), any(weight).([]float32), any(bias).([]float32), any(output).([]float32), batchSize, inFeatures, outFeatures)
	case []float64:
		LinearFloat64(any(x).([]float64), any(weight).([]float64), any(bias).([]float64), any(output).([]float64), batchSize, inFeatures, outFeatures)
	}
}

func init() {
	_ = hwy.NoSimdEnv // silence unused import
	initLinearFallback()
}

func initLinearFallback() {
	LinearFloat16 = BaseLinear_fallback_Float16
	LinearBFloat16 = BaseLinear_fallback_BFloat16
	LinearFloat32 = BaseLinear_fallback
	LinearFloat64 = BaseLinear_fallback_Float64
}
