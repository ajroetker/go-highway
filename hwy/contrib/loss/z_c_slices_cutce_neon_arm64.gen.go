//go:build !noasm && arm64
// Code generated by hwygen -c. DO NOT EDIT.

package loss

import (
	"unsafe"

	"github.com/ajroetker/go-highway/hwy"
	"github.com/ajroetker/go-highway/hwy/contrib/loss/asm"
)

func init() {
	initCutceNeonCAsm()
}

func initCutceNeonCAsm() {
	if hwy.NoSimdEnv() {
		return
	}
	CutCrossEntropyGrad = cutCrossEntropyGradAsmF32
}

func cutCrossEntropyGradAsmF32(hiddenStates, embeddings []float32, labels []int32, gradOutput []float32, numPositions, hiddenDim, vocabSize int) {
	var p_hiddenStates unsafe.Pointer
	if len(hiddenStates) > 0 {
		p_hiddenStates = unsafe.Pointer(&hiddenStates[0])
	}
	var p_embeddings unsafe.Pointer
	if len(embeddings) > 0 {
		p_embeddings = unsafe.Pointer(&embeddings[0])
	}
	var p_labels unsafe.Pointer
	if len(labels) > 0 {
		p_labels = unsafe.Pointer(&labels[0])
	}
	var p_gradOutput unsafe.Pointer
	if len(gradOutput) > 0 {
		p_gradOutput = unsafe.Pointer(&gradOutput[0])
	}
	numPositionsVal := int64(numPositions)
	hiddenDimVal := int64(hiddenDim)
	vocabSizeVal := int64(vocabSize)
	len_hiddenStatesVal := int64(len(hiddenStates))
	len_embeddingsVal := int64(len(embeddings))
	len_labelsVal := int64(len(labels))
	len_gradOutputVal := int64(len(gradOutput))
	asm.CutCrossEntropyGrad_F32(
		p_hiddenStates,
		p_embeddings,
		p_labels,
		p_gradOutput,
		unsafe.Pointer(&numPositionsVal),
		unsafe.Pointer(&hiddenDimVal),
		unsafe.Pointer(&vocabSizeVal),
		unsafe.Pointer(&len_hiddenStatesVal),
		unsafe.Pointer(&len_embeddingsVal),
		unsafe.Pointer(&len_labelsVal),
		unsafe.Pointer(&len_gradOutputVal),
	)
}

