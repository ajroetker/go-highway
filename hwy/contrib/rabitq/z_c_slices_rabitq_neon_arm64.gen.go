//go:build !noasm && arm64
// Code generated by hwygen -c. DO NOT EDIT.

package rabitq

import (
	"unsafe"

	"github.com/ajroetker/go-highway/hwy"
	"github.com/ajroetker/go-highway/hwy/contrib/rabitq/asm"
)

func init() {
	initRabitqNeonCAsm()
}

func initRabitqNeonCAsm() {
	if hwy.NoSimdEnv() || hwy.HasSME() {
		return
	}
	BitProduct = bitProductAsmU64
	QuantizeVectors = quantizeVectorsAsmF32
}

func bitProductAsmU64(code, q1, q2, q3, q4 []uint64) uint32 {
	var p_code unsafe.Pointer
	if len(code) > 0 {
		p_code = unsafe.Pointer(&code[0])
	}
	var p_q1 unsafe.Pointer
	if len(q1) > 0 {
		p_q1 = unsafe.Pointer(&q1[0])
	}
	var p_q2 unsafe.Pointer
	if len(q2) > 0 {
		p_q2 = unsafe.Pointer(&q2[0])
	}
	var p_q3 unsafe.Pointer
	if len(q3) > 0 {
		p_q3 = unsafe.Pointer(&q3[0])
	}
	var p_q4 unsafe.Pointer
	if len(q4) > 0 {
		p_q4 = unsafe.Pointer(&q4[0])
	}
	lenVal := int64(len(code))
	var out_result int64
	asm.BitProduct_U64(
		p_code,
		p_q1,
		p_q2,
		p_q3,
		p_q4,
		unsafe.Pointer(&lenVal),
		unsafe.Pointer(&out_result),
	)
	return uint32(out_result)
}

func quantizeVectorsAsmF32(unitVectors []float32, codes []uint64, dotProducts []float32, codeCounts []uint32, sqrtDimsInv float32, count, dims, width int) {
	var p_unitVectors unsafe.Pointer
	if len(unitVectors) > 0 {
		p_unitVectors = unsafe.Pointer(&unitVectors[0])
	}
	var p_codes unsafe.Pointer
	if len(codes) > 0 {
		p_codes = unsafe.Pointer(&codes[0])
	}
	var p_dotProducts unsafe.Pointer
	if len(dotProducts) > 0 {
		p_dotProducts = unsafe.Pointer(&dotProducts[0])
	}
	var p_codeCounts unsafe.Pointer
	if len(codeCounts) > 0 {
		p_codeCounts = unsafe.Pointer(&codeCounts[0])
	}
	countVal := int64(count)
	dimsVal := int64(dims)
	widthVal := int64(width)
	sqrtDimsInvVal := sqrtDimsInv
	len_unitVectorsVal := int64(len(unitVectors))
	len_codesVal := int64(len(codes))
	len_dotProductsVal := int64(len(dotProducts))
	len_codeCountsVal := int64(len(codeCounts))
	asm.QuantizeVectors_F32(
		p_unitVectors,
		p_codes,
		p_dotProducts,
		p_codeCounts,
		unsafe.Pointer(&sqrtDimsInvVal),
		unsafe.Pointer(&countVal),
		unsafe.Pointer(&dimsVal),
		unsafe.Pointer(&widthVal),
		unsafe.Pointer(&len_unitVectorsVal),
		unsafe.Pointer(&len_codesVal),
		unsafe.Pointer(&len_dotProductsVal),
		unsafe.Pointer(&len_codeCountsVal),
	)
}

