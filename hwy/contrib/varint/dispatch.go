// Copyright 2025 go-highway Authors
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

package varint

// Dispatch function variables for scalar-only functions.
// These don't use hwy.* operations, so hwygen doesn't generate dispatch for them.
// They are initialized to the base (pure Go) implementations and may be
// overridden by architecture-specific optimized implementations (e.g., GoAT assembly).
//
// Functions with hwy.* operations (FindVarintEnds, DecodeGroupVarint32) have
// their dispatch generated by hwygen in dispatch_*_*.gen.go files.

// Standard varint batch decode functions (scalar - no hwy.* operations)
var (
	// DecodeUvarint64Batch decodes up to n varints from src into dst
	DecodeUvarint64Batch func(src []byte, dst []uint64, n int) (decoded, consumed int)

	// Decode2Uvarint64 decodes exactly 2 varints (freq/norm pattern)
	Decode2Uvarint64 func(src []byte) (v1, v2 uint64, consumed int)

	// Decode5Uvarint64 decodes exactly 5 varints (location pattern)
	Decode5Uvarint64 func(src []byte) (values [5]uint64, consumed int)
)

// Group varint uint64 decode function (scalar - no hwy.* operations)
// DecodeGroupVarint32 dispatch is generated by hwygen (uses hwy.*).
var (
	// DecodeGroupVarint64 decodes 4 uint64 values from group-varint format
	DecodeGroupVarint64 func(src []byte) (values [4]uint64, consumed int)
)

func init() {
	// Initialize with base (pure Go) implementations.
	// These may be overridden by architecture-specific init() functions
	// in z_*.go files (e.g., z_varint_neon_arm64.go for ARM64 GoAT assembly).

	// Standard varint batch decoders
	DecodeUvarint64Batch = BaseDecodeUvarint64Batch
	Decode2Uvarint64 = BaseDecode2Uvarint64
	Decode5Uvarint64 = BaseDecode5Uvarint64

	// Group varint uint64 decoder
	DecodeGroupVarint64 = BaseDecodeGroupVarint64
}
