// Code generated by hwygen. DO NOT EDIT.
//go:build amd64 && goexperiment.simd

package varint

import (
	"github.com/ajroetker/go-highway/hwy"
	"simd/archsimd"
)

func BaseFindVarintEnds_avx2(src []byte) uint32 {
	if len(src) == 0 {
		return 0
	}
	n := min(len(src), 32)
	lanes := 32
	var mask uint32
	for i := 0; i+32 <= n; i += lanes {
		remaining := min(lanes, n-i)
		v := archsimd.LoadUint8x32Slice(src[i : i+remaining])
		highBitMask := hwy.TestBit(v, 7)
		for j := 0; j < remaining; j++ {
			if !func() bool {
				_vOne := archsimd.BroadcastInt32x32(1)
				_vZero := archsimd.BroadcastInt32x32(0)
				_vMasked := _vOne.Merge(_vZero, highBitMask)
				var _simd_mask_tmp [32]int32
				_vMasked.StoreSlice(_simd_mask_tmp[:])
				return _simd_mask_tmp[j] != 0
			}() {
				mask |= 1 << uint(i+j)
			}
		}
	}
	return mask
}
