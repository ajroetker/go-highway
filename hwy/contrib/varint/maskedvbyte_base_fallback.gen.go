// Code generated by hwygen. DO NOT EDIT.

package varint

import (
	"github.com/ajroetker/go-highway/hwy"
)

func BaseMaskedVByteDecodeBatch32_fallback(src []byte, dst []uint32, n int) (decoded int, consumed int) {
	if len(src) == 0 || n == 0 || len(dst) == 0 {
		return 0, 0
	}
	maxDecode := min(n, len(dst))
	pos := 0
	for decoded+4 <= maxDecode && pos+16 <= len(src) {
		numDecoded, bytesUsed := BaseMaskedVByteDecodeGroup_fallback(src[pos:], dst[decoded:])
		if numDecoded == 0 {
			break
		}
		decoded += numDecoded
		pos += bytesUsed
	}
	for decoded < maxDecode && pos < len(src) {
		val, bytesRead := baseMaskedVByteDecodeOne32(src[pos:])
		if bytesRead == 0 {
			break
		}
		dst[decoded] = val
		decoded++
		pos += bytesRead
	}
	return decoded, pos
}

func BaseMaskedVByteDecodeGroup_fallback(src []byte, dst []uint32) (decoded int, consumed int) {
	if len(src) < 16 || len(dst) < 4 {
		return 0, 0
	}
	srcVec := hwy.Load[uint8](src[:16])
	highBitMask := hwy.TestBit(srcVec, 7)
	var pattern uint16
	for i := 0; i < 12; i++ {
		if !highBitMask.GetBit(i) {
			pattern |= 1 << i
		}
	}
	if pattern == 0 {
		return 0, 0
	}
	lookup := &maskedVByte12LookupTable[pattern]
	if lookup.numValues == 0 {
		return 0, 0
	}
	shuffleMask := maskedVByte12ShuffleMasks[pattern][:]
	maskVec := hwy.Load[uint8](shuffleMask)
	shuffled := hwy.TableLookupBytes(srcVec, maskVec)
	var result [16]uint8
	hwy.Store(shuffled, result[:])
	numVals := int(lookup.numValues)
	start := 0
	for i := 0; i < numVals; i++ {
		end := int(lookup.valueEnds[i])
		length := end - start
		dst[i] = maskedVByteCombine(result[i*4:i*4+4], length)
		start = end
	}
	return numVals, int(lookup.bytesConsumed)
}
