// Code generated by github.com/ajroetker/go-highway/cmd/hwygen. DO NOT EDIT.

//go:build arm64

package matmul

import (
	"unsafe"

	"github.com/ajroetker/go-highway/hwy/asm"
)

func BaseInt8x8MatMul_neon(output []int32, a []uint8, b []uint8, aZP uint8, bZP uint8, M int, K int, N int) {
	if M == 0 || K == 0 || N == 0 {
		return
	}
	lanes := 4
	dequantBuf := [4]int32{}
	accBuf := make([]int32, N)
	azp := int32(aZP)
	bzp := int32(bZP)
	for m := range M {
		for i := range N {
			accBuf[i] = 0
		}
		for k := range K {
			aVal := int32(a[m*K+k]) - azp
			aVec := asm.BroadcastInt32x4(aVal)
			baseIdx := k * N
			var n int
			for n = 0; n+lanes <= N; n += lanes {
				for lane := range lanes {
					dequantBuf[lane] = int32(b[baseIdx+n+lane]) - bzp
				}
				bVec := asm.LoadInt32x4((*[4]int32)(unsafe.Pointer(&dequantBuf[0])))
				acc := asm.LoadInt32x4((*[4]int32)(unsafe.Pointer(&accBuf[n])))
				acc = aVec.Mul(bVec).Add(acc)
				acc.Store((*[4]int32)(unsafe.Pointer(&accBuf[n])))
			}
			for ; n < N; n++ {
				accBuf[n] += aVal * (int32(b[baseIdx+n]) - bzp)
			}
		}
		copy(output[m*N:(m+1)*N], accBuf)
	}
}
